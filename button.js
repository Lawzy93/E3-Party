"use strict";function ready(e){"loading"!==document.readyState?e():document.addEventListener?document.addEventListener("DOMContentLoaded",e):document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&e()}))}function wait(e){return new Promise((function(n){setTimeout(n,e)}))}function fadeIn(e,n){return new Promise((function(t){e.animate({opacity:[0,1]},{duration:n,fill:"both"}),setTimeout(t,n)}))}function fadeOut(e,n){return new Promise((function(t){e.animate({opacity:[1,0]},{duration:n,fill:"both"}),setTimeout(t,n)}))}function startSplash(){var e=document.getElementById("splash");e.style.display="flex",fadeIn(e,500).then((function(){return wait(1e3)})).then((function(){return fadeOut(e,500)})).then((function(){e.style.display="none",startRegister()}))}function startRegister(){var e=document.getElementById("register");e.style.display="flex",fadeIn(e,500),document.addEventListener("keydown",submitHost)}function submitHost(e){if(!e.repeat)if("Enter"==e.key){document.removeEventListener("keydown",submitHost),startConnection(document.getElementById("hostInput").value.toUpperCase());var n=document.getElementById("register");fadeOut(n,500).then((function(){n.style.display="none",startHome()}))}else console.log("Untracked key press:  ".concat(e.key," (").concat(e.code,")"))}function startHome(){var e=document.getElementById("home");e.style.display="flex",fadeIn(e,500);var n=document.getElementById("button");n.addEventListener("mousedown",buttonPressed),n.addEventListener("touchstart",buttonPressed),n.addEventListener("mouseup",buttonReleased),n.addEventListener("touchend",buttonReleased)}function buttonPressed(){sendMessage("pressed")}function buttonReleased(){sendMessage("released")}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}ready((function(){startSplash()}));var WB_Ably,WB_AblyChannel,connection,WB_apiKey="IcInwQ.EXOP6A:my1jVvtSiO8hrn2xxI2RBFodhmcCJFuvO2POgF7wqz4",WB_clientID="",audio=new Audio("https://notificationsounds.com//storage/sounds/file-sounds-979-get-outta-here.mp3");function startConnection(e){var n="HOST-"+e;WB_clientID=e+"-"+Math.random().toString(36).substring(2,16),WB_Ably=new Ably.Realtime({key:WB_apiKey,clientId:WB_clientID}),(WB_AblyChannel=WB_Ably.channels.get("E3-Party")).presence.enter(),WB_AblyChannel.subscribe("ablywebrtc-signal/".concat(WB_clientID),(function(e){e.data.user==n&&connection.handleSignal(e.data.signal)})),connection=new Connection(n,WB_AblyChannel,!0)}function sendMessage(e){connection.send(e)}function receiveMessage(e,n){messageList[e]||(messageList[e]=[]),n=JSON.parse(n),readStatus[e]=!0,messageList[e].push({user:e,message:n.message}),audio.play(),renderMembers(),render()}var Connection=function(){function e(n,t,o){_classCallCheck(this,e),console.log("Opening connection to ".concat(n)),this._remoteClient=n,this.isConnected=!1,this._p2pConnection=new SimplePeer({initiator:o,trickle:!1}),this._p2pConnection.on("signal",this._onSignal.bind(this)),this._p2pConnection.on("error",this._onError.bind(this)),this._p2pConnection.on("connect",this._onConnect.bind(this)),this._p2pConnection.on("close",this._onClose.bind(this)),this._p2pConnection.on("data",this._onData.bind(this))}return _createClass(e,[{key:"handleSignal",value:function(e){this._p2pConnection.signal(e)}},{key:"send",value:function(e){this._p2pConnection.send(e)}},{key:"_onSignal",value:function(e){WB_AblyChannel.publish("ablywebrtc-signal/".concat(this._remoteClient),{user:WB_clientID,signal:e})}},{key:"_onConnect",value:function(){this.isConnected=!0,console.log("connected to "+this._remoteClient)}},{key:"_onClose",value:function(){console.log("connection to ".concat(this._remoteClient," closed")),delete connections[this._remoteClient]}},{key:"_onData",value:function(e){receiveMessage(this._remoteClient,e)}},{key:"_onError",value:function(e){console.log("an error occurred ".concat(e.toString()))}}]),e}();