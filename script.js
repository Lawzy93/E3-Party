"use strict";function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){i=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(i)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var GP_Buttons={};function GP_checkAll(){var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],t=Date.now();for(var n in GP_Buttons)n.substring(0,4)==WB_hostName&&(GP_Buttons[n].updated=t,GP_Buttons[n].pressed?GP_Buttons[n].held+=listeningRate:(GP_Buttons[n].released=GP_Buttons[n].held,GP_Buttons[n].held=0));var r,a=_createForOfIteratorHelper(e);try{var o=function(){var e=r.value;e&&e.buttons.forEach((function(n,r){var a="GP"+e.index+"-"+GP_idToText(r);GP_Buttons.hasOwnProperty(a)&&(GP_Buttons[a].updated=t,GP_Buttons[a].pressed=n.pressed,n.pressed?GP_Buttons[a].held+=listeningRate:(GP_Buttons[a].released=GP_Buttons[a].held,GP_Buttons[a].held=0))}))};for(a.s();!(r=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}GP_Buttons.hasOwnProperty("KB_SPACEBAR")&&(GP_Buttons.KB_SPACEBAR.updated=t,GP_Buttons.KB_SPACEBAR.pressed?GP_Buttons.KB_SPACEBAR.held+=listeningRate:(GP_Buttons.KB_SPACEBAR.released=GP_Buttons.KB_SPACEBAR.held,GP_Buttons.KB_SPACEBAR.held=0))}function GP_registerNewButtons(){var e,t=_createForOfIteratorHelper(navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[]);try{var n=function(){var t=e.value;t&&t.buttons.forEach((function(e,n){if(e.pressed){var r="GP"+t.index+"-"+GP_idToText(n);GP_Buttons.hasOwnProperty(r)||GP_ButtonsAdd(r)}}))};for(t.s();!(e=t.n()).done;)n()}catch(e){t.e(e)}finally{t.f()}}function GP_ButtonsAdd(e){GP_Buttons[e]={},GP_Buttons[e].state="",GP_Buttons[e].saved="",GP_Buttons[e].updated="YET TO BE UPDATED",GP_Buttons[e].colour="white",GP_Buttons[e].honk="default",GP_Buttons[e].pressed=!1,GP_Buttons[e].held=0,GP_Buttons[e].released=0,GP_Buttons[e].element=document.getElementById("sampleButton").cloneNode(!0),GP_Buttons[e].element.id=e,document.getElementById("buttonBar").append(GP_Buttons[e].element),console.log("Registered Button: "+e)}function GP_vibrate_connect(e){GP_vibrate(e,300,.5,.5).then((function(){return wait(100)})).then((function(){return GP_vibrate(e,300,.5,.1)}))}function GP_vibrate(e,t,n,r){return new Promise((function(a,o){null!=e.vibrationActuator&&e.vibrationActuator.playEffect("dual-rumble",{duration:t,weakMagnitude:n,strongMagnitude:r}),setTimeout(a,t)}))}function GP_idToText(e){var t="Button not found";switch(e){case 0:t="X";break;case 1:t="○";break;case 2:t="□";break;case 3:t="△";break;case 4:t="L1";break;case 5:t="R1";break;case 6:t="L2";break;case 7:t="R2";break;case 8:t="SHARE";break;case 9:t="OPTION";break;case 10:t="L3";break;case 11:t="R3";break;case 12:t="⇧";break;case 13:t="⇩";break;case 14:t="⇦";break;case 15:t="⇨";break;case 16:t="㎰";break;case 17:t="▨"}return t}function ready(e){"loading"!==document.readyState?e():document.addEventListener?document.addEventListener("DOMContentLoaded",e):document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&e()}))}function wait(e){return new Promise((function(t){setTimeout(t,e)}))}function fadeIn(e,t){return new Promise((function(n){e.animate({opacity:[0,1]},{duration:t,fill:"both"}),setTimeout(n,t)}))}function fadeOut(e,t){return new Promise((function(n){e.animate({opacity:[1,0]},{duration:t,fill:"both"}),setTimeout(n,t)}))}function updateButton(e,t){var n=800,r=e.element.querySelector(".text"),a=e.element.querySelector(".button_icon"),o="noIcon";switch(e.state){case"Love This!!":o="fa-heart";break;case"Skip":case"skip":o="fa-forward";break;case"Ready":o="fa-thumbs-up"}if(a.classList.contains(o)||(a.className="button_icon fa-fw fa-solid",a.classList.add(o)),e.pressed){var s=e.held%1100,i=e.held%(1100*t.length),c=Math.floor(i/1100);s<n?(r.innerHTML=t[c],r.style.opacity=s/1100*6):r.innerHTML=" "}else if(r.innerHTML=" ",e.released>0){var l=e.released%1100,u=e.released%(1100*t.length),d=Math.floor(u/1100);l<n&&(e.state=t[d])}}function updateKeyboardBar(e){if(document.getElementById("keyboardBar").append(document.createElement("div")),e){var t,n=[];for(var r in e){var a=document.createElement("span");if(a.classList.add("keycap"),a.innerText=lookupKeycap(r),n.push(a),""!=e[r]){var o=document.createElement("span");o.classList.add("text"),o.innerText=e[r],n.push(o)}}(t=document.getElementById("keyboardBar")).replaceChildren.apply(t,n)}else document.getElementById("keyboardBar").replaceChildren()}function lookupKeycap(e){var t=e.toUpperCase();switch(t){case"ENTER":return"e";case"ESC":return"^";case"SPACE":return"k";case"LEFT":return"z";case"RIGHT":return"x";case"UP":return"w";case"DOWN":return"y";default:return t.charAt(0)}}ready((function(){window.addEventListener("gamepadconnected",(function(e){var t=e.gamepad;console.log("Gamepad connected: "+t.id),GP_vibrate_connect(t)})),window.addEventListener("gamepaddisconnected",(function(e){var t=e.gamepad;console.log("Gamepad disconnected: "+t.id)}))}));var keyPressHandler={};function clearKeyPressHandler(){for(var e in keyPressHandler)keyPressHandler[e]=void 0}function searchKeyEnter(){clearKeyPressHandler(),search(document.getElementById("searchInput").value);var e=document.getElementById("search");fadeOut(e,500).then((function(){e.style.display="none",startSelect()}))}function selectKeyLeft(){var e=document.getElementById("searchResults");if(e.querySelector(".selected")){var t=parseInt(e.querySelector(".selected").id);if(t>0){e.querySelector("[id='".concat(t,"']")).classList.remove("selected");var n=t-1;e.querySelector("[id='".concat(n,"']")).classList.add("selected")}}else e.querySelector("[id='0']").classList.add("selected")}function selectKeyRight(){var e=document.getElementById("searchResults");if(e.querySelector(".selected")){var t=parseInt(e.querySelector(".selected").id);if(t<e.querySelectorAll(".thumb").length-1){e.querySelector("[id='".concat(t,"']")).classList.remove("selected");var n=t+1;e.querySelector("[id='".concat(n,"']")).classList.add("selected")}}else e.querySelector("[id='0']").classList.add("selected")}function selectKeyBack(){clearKeyPressHandler(),document.getElementById("searchInput").value="";var e=document.getElementById("select");fadeOut(e,500).then((function(){e.style.display="none",startSearch()}))}function selectKeyEnter(){clearKeyPressHandler(),YT_playlist(document.querySelector(".selected").getAttribute("data-playlistId")),YT_shuffle();var e=document.getElementById("select");fadeOut(e,500).then((function(){e.style.display="none",startRegister()}))}function registerKeyBack(){for(var e in clearKeyPressHandler(),clearInterval(listeningInterval),GP_Buttons)delete GP_Buttons[e];KB_SPACEBAR_RemoveListeners(),document.getElementById("buttonBar").replaceChildren(),document.getElementById("searchInput").value="";var t=document.getElementById("register");fadeOut(t,500).then((function(){t.style.display="none",startSearch()}))}function registerKeySpace(){GP_Buttons.hasOwnProperty("KB_SPACEBAR")||(GP_ButtonsAdd("KB_SPACEBAR"),document.addEventListener("keydown",KB_SPACEBAR_KeyDownListener),document.addEventListener("keyup",KB_SPACEBAR_KeyUpListener))}function KB_SPACEBAR_KeyDownListener(e){" "!=e.key||e.repeat||(GP_Buttons.KB_SPACEBAR.pressed=!0)}function KB_SPACEBAR_KeyUpListener(e){" "==e.key&&(GP_Buttons.KB_SPACEBAR.pressed=!1)}function KB_SPACEBAR_RemoveListeners(){document.removeEventListener("keydown",KB_SPACEBAR_KeyDownListener),document.removeEventListener("keyup",KB_SPACEBAR_KeyUpListener)}ready((function(){document.addEventListener("keydown",(function(e){e.repeat||(void 0!==keyPressHandler[e.key]?keyPressHandler[e.key]():console.log("Untracked key press:  ".concat(e.key," (").concat(e.code,")")))}))}));var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var player,firstScriptTag=document.getElementsByTagName("script")[0];function onYouTubeIframeAPIReady(){player=new YT.Player("player",{height:.98*Window.innerHeight,width:.98*Window.innerWidth,playerVars:{autoplay:0,controls:0,disablekb:1,enablejsapi:1,fs:0,iv_load_policy:3,modestbranding:1,origin:webOrigin,playsinline:1},videoId:"wUF9DeWJ0Dk",events:{onReady:YT_onPlayerReady,onStateChange:YT_onPlayerStateChange}})}function YT_onPlayerReady(e){}function YT_onPlayerStateChange(e){if(console.log(e.data),-1==e.data)for(var t in GP_Buttons)GP_Buttons[t].state=""}function YT_shuffle(){player.setShuffle(!0)}function YT_pause(){player.pauseVideo()}function YT_start(){player.setVolume(100),player.unMute(),player.playVideo()}function YT_playlist(e){player.cuePlaylist({list:e})}function YT_skip(){player.nextVideo()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);var listeningInterval,version="3.4.2",listeningRate=100,colours=["red","orange","yellow","green","blue","purple","white","black","magenta","olive","hotpink","limegreen"];function startSplash(){var e=document.getElementById("splash");e.style.display="flex",updateKeyboardBar(),fadeIn(e,500).then((function(){return wait(1e3)})).then((function(){return fadeOut(e,500)})).then((function(){e.style.display="none",startSearch()}))}function startSearch(){var e=document.getElementById("search");e.style.display="flex",WB_state="",updateKeyboardBar({Enter:"search"}),document.getElementById("searchInput").focus(),fadeIn(e,500),keyPressHandler.Enter=function(){return searchKeyEnter()}}function startSelect(){var e=document.getElementById("select");e.style.display="flex",updateKeyboardBar({Left:"",Right:"",Enter:"select playlist",Esc:"go back"}),fadeIn(e,500),keyPressHandler.Enter=function(){return selectKeyEnter()},keyPressHandler[" "]=function(){return selectKeyEnter()},keyPressHandler.Backspace=function(){return selectKeyBack()},keyPressHandler.Escape=function(){return selectKeyBack()},keyPressHandler.ArrowLeft=function(){return selectKeyLeft()},keyPressHandler.ArrowRight=function(){return selectKeyRight()}}function startRegister(){var e=document.getElementById("register");e.style.display="flex",document.getElementById("webButtonURL").innerText="register a WEB BUTTON at ".concat(webOrigin,"/button"),document.getElementById("webButtonHostID").innerText="CODE: ".concat(WB_hostName.toLowerCase()),updateKeyboardBar({Space:"add KEYBOARD button",Esc:"go back"}),WB_state="register",fadeIn(e,500),listeningInterval=setInterval((function(){GP_registerNewButtons(),GP_checkAll();var t=!0;for(var n in 0===Object.keys(GP_Buttons).length&&(t=!1),GP_Buttons){var r=GP_Buttons[n];switch(updateButton(r,["Honk!!","Ready","Remove","New Colour","New Honk"]),"Ready"!=r.state&&(t=!1),r.state){case"Honk!!":r.state="",SND_play(r.honk);break;case"Remove":"KB_SPACEBAR"==n&&KB_SPACEBAR_RemoveListeners(),r.element.remove(),delete GP_Buttons[n];break;case"New Colour":r.state="";var a=[].concat(colours);a.splice(a.indexOf(r.colour),1);var o=a[Math.floor(Math.random()*a.length)];r.colour=o,r.element.querySelector(".button").style.background=o,r.element.querySelector(".button_icon").style.color=o;break;case"New Honk":r.state="";var s=_toConsumableArray(Object.keys(SND_sounds));s.splice(s.indexOf(r.honk),1);var i=s[Math.floor(Math.random()*s.length)];r.honk=i,SND_play(r.honk)}}t&&(clearKeyPressHandler(),clearInterval(listeningInterval),fadeOut(e,500).then((function(){e.style.display="none",startPlay()})))}),listeningRate),keyPressHandler.Backspace=function(){return registerKeyBack()},keyPressHandler.Escape=function(){return registerKeyBack()},keyPressHandler[" "]=function(){return registerKeySpace()}}function startPlay(){document.body.classList.remove("grey"),document.body.classList.add("black");var e=document.getElementById("play");for(var t in e.style.display="flex",WB_state="play",updateKeyboardBar(),fadeIn(e,500).then((function(){YT_start()})),GP_Buttons)GP_Buttons[t].state=GP_Buttons[t].saved;listeningInterval=setInterval((function(){GP_checkAll();var t=!0;for(var n in 0===Object.keys(GP_Buttons).length&&(t=!1),GP_Buttons){var r=GP_Buttons[n];switch("skip"==r.state||"Super Skip"==r.state?updateButton(r,["Super Skip","Let It Play","Pause..."]):(t=!1,updateButton(r,["Skip","Love This!!","Pause"])),r.state){case"Skip":SND_play(r.honk),r.state="skip";break;case"Super Skip":r.state="skip";break;case"Love This!!":break;case"Let It Play":t=!1,r.state="";break;case"Pause":for(var a in YT_pause(),clearKeyPressHandler(),clearInterval(listeningInterval),r.state="",GP_Buttons)GP_Buttons[a].saved=GP_Buttons[a].state,GP_Buttons[a].state="";fadeOut(e,500).then((function(){e.style.display="none",startPause()}));break;case"Pause...":for(var o in r.state="skip",YT_pause(),clearKeyPressHandler(),clearInterval(listeningInterval),r.state="",GP_Buttons)GP_Buttons[o].saved=GP_Buttons[o].state,GP_Buttons[o].state="";fadeOut(e,500).then((function(){e.style.display="none",startPause()}))}}if(t){for(var s in GP_Buttons)GP_Buttons[s].state="";YT_skip()}}),listeningRate)}function startPause(){document.body.classList.remove("black"),document.body.classList.add("grey");var e=document.getElementById("pause");e.style.display="flex",WB_state="register",updateKeyboardBar({Space:"add as KEYBOARD button",Esc:"go back"}),fadeIn(e,500),listeningInterval=setInterval((function(){GP_registerNewButtons(),GP_checkAll();var t=!0;for(var n in 0===Object.keys(GP_Buttons).length&&(t=!1),GP_Buttons){var r=GP_Buttons[n];switch(updateButton(r,["Honk!!","Ready","Remove","New Colour","New Honk"]),"Ready"!=r.state&&(t=!1),r.state){case"Honk!!":r.state="",SND_play(r.honk);break;case"Remove":"KB_SPACEBAR"==n&&KB_SPACEBAR_RemoveListeners(),r.element.remove(),delete GP_Buttons[n];break;case"New Colour":r.state="";var a=[].concat(colours);a.splice(a.indexOf(r.colour),1);var o=a[Math.floor(Math.random()*a.length)];r.colour=o,r.element.querySelector(".button").style.background=o,r.element.querySelector(".button_icon").style.color=o;break;case"New Honk":r.state="";var s=_toConsumableArray(Object.keys(SND_sounds));s.splice(s.indexOf(r.honk),1);var i=s[Math.floor(Math.random()*s.length)];r.honk=i,SND_play(r.honk)}}if(t){for(var c in clearKeyPressHandler(),clearInterval(listeningInterval),GP_Buttons)GP_Buttons[c].state=GP_Buttons[c].saved,GP_Buttons[c].saved="";fadeOut(e,500).then((function(){e.style.display="none",startPlay()}))}}),listeningRate),keyPressHandler[" "]=function(){return registerKeySpace()}}ready((function(){startSplash()}));var apiKey="AIzaSyCniO30nub42x6lHMjjSo4FirgYKScZJLo";function search(e){var t="https://www.googleapis.com/youtube/v3/search?part=snippet&type=playlist&maxResults=5"+"&key=".concat(apiKey)+"&q=".concat(e);fetch(t).then((function(e){return e.json()})).then((function(e){var t,n=[];e.items.forEach((function(e,t){n[t]=document.getElementById("sampleThumb").cloneNode(!0),n[t].id=t,n[t].setAttribute("data-playlistId",e.id.playlistId),n[t].addEventListener("mouseenter",(function(){document.querySelector(".selected")&&document.querySelector(".selected").classList.remove("selected"),this.classList.add("selected")})),n[t].addEventListener("mouseleave",(function(){this.classList.remove("selected")})),n[t].addEventListener("click",selectKeyEnter),n[t].querySelector("img").src=e.snippet.thumbnails.default.url,n[t].querySelector("p").textContent=e.snippet.title})),(t=document.getElementById("searchResults")).replaceChildren.apply(t,n),n[0].classList.add("selected")}))}var SND_sounds={default:"https://cdn.freesound.org/previews/539/539672_8272284-lq.mp3",bike:"https://cdn.freesound.org/previews/634/634034_13976474-lq.mp3",denied:"https://cdn.freesound.org/previews/419/419023_215268-lq.mp3",aliens:"https://cdn.freesound.org/previews/530/530480_2532248-lq.mp3",microwave:"https://cdn.freesound.org/previews/218/218839_4026784-lq.mp3",underwaterPop:"https://cdn.freesound.org/previews/361/361603_6436456-lq.mp3",boatHorn:"https://cdn.freesound.org/previews/608/608088_6456158-lq.mp3",digital:"https://cdn.freesound.org/previews/178/178490_3318082-lq.mp3",bark:"https://cdn.freesound.org/previews/72/72723_422555-lq.mp3"};function SND_play(e){new Audio(SND_sounds[e]).oncanplaythrough=function(){this.volume=.75,this.play()}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}ready((function(){for(var e in SND_sounds)new Audio(SND_sounds[e])}));var WB_apiKey="IcInwQ.EXOP6A:my1jVvtSiO8hrn2xxI2RBFodhmcCJFuvO2POgF7wqz4",WB_hostName=Math.random().toString(36).substring(2,6).toUpperCase(),WB_hostID="HOST-"+WB_hostName,WB_Ably=new Ably.Realtime({key:WB_apiKey,clientId:WB_hostID}),WB_AblyChannel=WB_Ably.channels.get("E3-Party"),membersList=[],connections={},WB_state="";function receiveMessage(e,t){console.log(e+": "+t),"register"==WB_state?GP_Buttons.hasOwnProperty(e)?"pressed"==t?GP_Buttons[e].pressed=!0:"released"==t&&(GP_Buttons[e].pressed=!1):GP_ButtonsAdd(e):"play"==WB_state&&("pressed"==t?GP_Buttons[e].pressed=!0:"released"==t&&(GP_Buttons[e].pressed=!1))}WB_AblyChannel.presence.enter(),WB_AblyChannel.subscribe("ablywebrtc-signal/".concat(WB_hostID),(function(e){connections[e.data.user]||(connections[e.data.user]=new Connection(e.data.user,WB_AblyChannel,!1)),connections[e.data.user].handleSignal(e.data.signal)}));var Connection=function(){function e(t,n,r){_classCallCheck(this,e),console.log("Opening connection to ".concat(t)),this._remoteClient=t,this.isConnected=!1,this._p2pConnection=new SimplePeer({initiator:r,trickle:!1}),this._p2pConnection.on("signal",this._onSignal.bind(this)),this._p2pConnection.on("error",this._onError.bind(this)),this._p2pConnection.on("connect",this._onConnect.bind(this)),this._p2pConnection.on("close",this._onClose.bind(this)),this._p2pConnection.on("data",this._onData.bind(this))}return _createClass(e,[{key:"handleSignal",value:function(e){this._p2pConnection.signal(e)}},{key:"send",value:function(e){this._p2pConnection.send(e)}},{key:"_onSignal",value:function(e){WB_AblyChannel.publish("ablywebrtc-signal/".concat(this._remoteClient),{user:WB_hostID,signal:e})}},{key:"_onConnect",value:function(){this.isConnected=!0,console.log("connected to "+this._remoteClient)}},{key:"_onClose",value:function(){console.log("connection to ".concat(this._remoteClient," closed")),delete connections[this._remoteClient]}},{key:"_onData",value:function(e){receiveMessage(this._remoteClient,e)}},{key:"_onError",value:function(e){console.log("an error occurred ".concat(e.toString()))}}]),e}();